<!DOCTYPE html>
<html>

<head>
  <link rel = "stylesheet"
  type = "text/css"
  href = "index.css" />
</head>


<body onload="doWebGazer();";>

 <!--<div style="
  position: absolute;
  bottom: 200px;
  left: 0px;
  ">
      <input id="one" type="button" class="key" value="1" onclick="updateTextfield('One')"/> 
  </div> -->

  <div style="
  position: absolute;
  top: 0px;
  left: 350px;
  ">
    <input style="font-size: 64px;" id="one" type="button" class="key" value="Yes"/> 
  </div>

  <div style="
  position: absolute;
  top: 0px;
  left: 700px;
  ">
    <input style="font-size: 64px;" id="two" type="button" class="key" value="No"/> 
  </div>

  <div style="
  position: absolute;
  top: 0px;
  left: 1050px;
  ">
    <input style="font-size: 64px;" id="three" type="button" class="key" value="N/a"/> 
  </div>

 <!-- Add input box to display text -->
  <div style="
  text-align: center;
  position: absolute;
  top: 550px;
  left: 580px;
  visibility: hidden;
  ">
      <input class="input2"/> 
  </div>
  
  <div style="
  text-align: center;
  position: absolute;
  top: 500px;
  left: 580px;
  visibility: hidden;
  ">
      <input class="act"/> 
  </div>
  


<script src="./webgazer.js"></script>
<script>
var xx = 0;
var yy = 0;
var active = 0;

// add text to text field
    function updateTextfield(input){
      document.querySelector(".input2").value = input;
    }
	
	function updateTextfield2(input){
      document.querySelector(".act").value = input;
    }
	
	function clearTextfield(){
        document.querySelector(".input2").value = "";
    }
		document.addEventListener("keypress", function(event) {
		if (event.keyCode == 49) {
			document.getElementById("one").style.background='#c8d6e5';
			document.getElementById("two").style.background='#c8d6e5';
			document.getElementById("three").style.background='#c8d6e5';
			webgazer.resume();
		}
		if (event.keyCode == 50) {
		
			active = !active;
			if (active)
			{
				updateTextfield2("Buttons Are Enabled");
				document.body.style.backgroundColor = "#1dd1a1";
			}
			else
			{
				updateTextfield2("Buttons Are Disabled");
				document.body.style.backgroundColor = "#ff6b6b";
			}
			
		}
	})

	
function doWebGazer()
    {
     	webgazer.begin();
		webgazer.showPredictionPoints(true);
		webgazer.setRegression('ridge');
		
		document.body.style.backgroundColor = "#ff6b6b";
		updateTextfield2("Buttons Are Disabled");
		
		
		document.getElementById("one").style.background='#c8d6e5';
		document.getElementById("two").style.background='#c8d6e5';
		document.getElementById("three").style.background='#c8d6e5';
		
		xcoordinates = [];
		ycoordinates = [];
		var buttonHeight=60;
		var buttonWidth=120;
		var bottomY=638; // height of canvas
		var rightX=1356; // width of canvas
		var buttonXDistance;
		var buttonYDistance;
		var xAvg = 0.0;
		var yAvg = 0.0;

		var intervalID = window.setInterval(function(){
		xAvg = getAvgCoordinates(xcoordinates);
		yAvg = getAvgCoordinates(ycoordinates);
		xcoordinates = [];
		ycoordinates = [];
	
		if (active)
		{
			if (xAvg > 350 && xAvg < 350+300 && yAvg > 0 && yAvg < 300)
			{
				clearTextfield();
				updateTextfield('Yes');
				//active = 0;
				document.getElementById("one").style.background='#feca57';
				webgazer.pause();
			}
			
			else if (xAvg > 700 && xAvg < 700+300 && yAvg > 0 && yAvg < 300)
			{
				clearTextfield();
				updateTextfield('No');
				//active = 0;
				document.getElementById("two").style.background='#feca57';
				webgazer.pause();
			}
			else if (xAvg > 1050 && xAvg < 1050+300 && yAvg > 0 && yAvg < 300)
			{
				clearTextfield();
				updateTextfield('N/a');
				//active = 0;
				document.getElementById("three").style.background='#feca57';
				webgazer.pause();
			}
		}
		
 	}, 3000); // cycle runs every 500 milliseconds


      // sets up the canvas
      var canvas = document.getElementById("screenCanvas");
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      // set red pointer on screen to reflect where gaze is
      var ctx = canvas.getContext("2d");
      ctx.fillStyle = "#FF0000"; 
    }



    // find average of coordinates
    function getAvgCoordinates(arr)
    {
      var sum, avg = 0;

      if (arr.length)
      {
          sum = arr.reduce(function(a, b) { return a + b; });
          avg = sum / arr.length;
      }

      return avg
    }

	webgazer.setGazeListener(function(data, elapsedTime) 
	{
		if (data == null)
		{
		  return;
		}

		var prediction = webgazer.getCurrentPrediction();

		if (prediction)
		{
			var checkx = prediction.x;
			var checky = prediction.y;
			xcoordinates.push(checkx);
			ycoordinates.push(checky);
			
			if (xcoordinates.length>10)
			{
				xcoordinates.shift();
				ycoordinates.shift();
			}          
		}
    }).begin();



</script>

<canvas id="circle" width="500" height="400"></canvas>
</body>
</html>
