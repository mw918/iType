<!DOCTYPE html>
<html>
<head>
  <link rel = "stylesheet"
  type = "text/css"
  href = "index.css" />
</head>
</head>

<canvas id="screenCanvas" style="border:1px solid #a282ec;"></canvas>

<body onload="doWebGazer()";>
  <script src="webgazer.js" type="text/javascript" ></script>

  <div style="
  position: absolute;
  top: 0px;
  right: 610px;
  ">
      <input id="1" type="button" class="key" value="1" onclick="updateTextfield('1')"/> 
  </div> 

  <div style="
  position: absolute;
  top: 0px;
  right: 305px;
  ">
    <input id="2" type="button" class="key" value="2" onclick="updateTextfield('2')"/> 
  </div>

  <div style="
  position: absolute;
  top: 0px;
  right: 10px;
  ">
    <input id="3" type="button" class="key" value="3" onclick="updateTextfield('3')"/> 
  </div>

  <div style="
  position: absolute;
  top: 200px;
  right: 0px;
  ">
    <input id="4" type="button" class="key" value="4" onclick="updateTextfield('4')"/> 
  </div>

  <div style="
  position: absolute;
  top: 400px;
  right: 0px;
  ">
    <input id="5" type="button" class="key" value="5" onclick="updateTextfield('5')"/> 
  </div>

  <div style="
  position: absolute;
  bottom: 0px;
  right: 0px;
  ">
      <input id="6" type="button" class="key" value="6" onclick="updateTextfield('6')"/> 
    </div>  

  <div style="
  position: absolute;
  bottom: 0px;
  right: 305px;
  ">
      <input id="7" type="button" class="key" value="7" onclick="updateTextfield('7')"/> 
  </div> 

  <div style="
  position: absolute;
  bottom: 0px;
  right: 610px;
  ">
    <input id="8" type="button" class="key" value="8" onclick="updateTextfield('8')"/> 
  </div> 

  <div style="
  position: absolute;
  bottom: 0px;
  left: 305px;
  ">
      <input id="9" type="button" class="key" value="9" onclick="updateTextfield('9')"/> 
  </div> 

  <div style="
    position: absolute;
    bottom: 0px;
    left: 0px;
    ">
      <input id="0" type="button" class="key" value="0" onclick="updateTextfield('0')"/> 
  </div> 

  
  <div style="
  text-align: center;
  position: absolute;
  top: 250px;
  left: 550px;
  ">
      <input class="input"/> 
  </div>

  <div style="
  text-align: center;
  position: absolute;
  bottom: 200px;
  left: 0px;">
      <input id="backspace" type="button" class="key" value="backspace" onclick="clearTextfield()"/> 
  </div>

  
  

  <script>
    function doWebGazer()
    {
      webgazer.begin();
      xcoordinates = [];
      ycoordinates = [];
      //var xAvg;
      //var yAvg;
      var buttonSize=50;
      var bottomY=580;
      var rightX=1200;
      var intervalID = window.setInterval(function(){
        xAvg = getAvgCoordinates(xcoordinates);
        yAvg = getAvgCoordinates(ycoordinates);
        //var avg = (xAvg + yAvg)/2;
        xcoordinates = [];
        ycoordinates = [];
        //console.log(avg)
        //if (avg > 500 && avg < 800) {
        if (xAvg> rightX && yAvg<buttonSize){
          document.getElementById('h').click(); 
        } 
        //if (avg < 0) {
        if (xAvg> rightX && yAvg>bottomY){
          document.getElementById('e').click();
        }
        //if (avg > 200 && avg < 300) {
        if (xAvg< buttonSize && yAvg>bottomY){
          document.getElementById('y').click();
        }        
      }, 500);
    
      //Sets up the canvas
      var canvas = document.getElementById("screenCanvas");
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
      var ctx = canvas.getContext("2d");
      ctx.fillStyle = "#FF0000";

      webgazer.setGazeListener(function(data, elapsedTime) 
      {
          if (data == null)
          {
              return;
          }

          var prediction = webgazer.getCurrentPrediction();
          if (prediction)
          {
              var checkx = prediction.x;
              var checky = prediction.y;
              xcoordinates.push(checkx);
              ycoordinates.push(checky);
              if (xcoordinates.length>10)
              {
                xcoordinates.shift();
                ycoordinates.shift();
              }
              //ctx.fillRect(checkx, checky, 20, 20);
              ctx.fillRect(xAvg, yAvg, 20, 20);
                if (elapsedTime%3>2)
                {
                    ctx.clearRect(0, 0, 1356, 638);
                }
          }
      }).begin();
    }

    function getAvgCoordinates(arr)
    {
      var sum, avg = 0;

      if (arr.length)
      {
          sum = arr.reduce(function(a, b) { return a + b; });
          avg = sum / arr.length;
      }

      return avg
    }

    function updateTextfield(input){
      document.querySelector(".input").value += input;
    }

    function clearTextfield(){
      document.querySelector(".input").value = "";
    }
</script>    

</body>
</html>
